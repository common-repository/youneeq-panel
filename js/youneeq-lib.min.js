var YouneeqHandler=function(){function YouneeqHandler(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=null),this.use_scroll_handler=!1,this.scroll_ready=!0,!this||!this.init_all_data)throw'YouneeqHandler() must be called with "new"';this.box=e,this.id_num=YouneeqHandler.instances.length,this.content_id="",this.alt_href="",this.content_type="article",this.suggest={},this.observe={},this.tracking={},this.scrolling={},this.features=[],this.is_loading=!1,YouneeqHandler.instances.push(t?this.init_all_data(n).request(["first","observe"]):this.init_all_data(n))}return YouneeqHandler.generate=function(e){void 0===e&&(e=!0);var t,n=jQuery("#youneeq, .youneeq, youneeq-section").get().sort(function(e,t){var n=jQuery(e).attr("data-yq-priority"),i=jQuery(t).attr("data-yq-priority");return n=n?parseInt(n):0,i=i?parseInt(i):0,n>i?1:n<i?-1:0});if(t=n.length?function(){Yq.onready(function(){n.forEach(function(e){var t=jQuery(e),n=new YouneeqHandler(e,!t.hasClass("yq-no-auto"));t.data("youneeqHandler",n)})})}:jQuery.noop,e){var i=[];"JSON"in window||i.push(jQuery.getScript("//api.youneeq.ca/scripts/json2.js")),"jzTimezoneDetector"in window||i.push(jQuery.getScript("//api.youneeq.ca/scripts/detect_timezone.js")),"Yq"in window||i.push(jQuery.getScript("https://api.youneeq.ca/app/yqmin")),i.length?jQuery.when.apply(jQuery,i).then(t):t()}else t()},YouneeqHandler.track_click=function(e,t,n){var i=1==n.which;i&&n.preventDefault();var a=e.data("yqId"),s=Yq.titleTrim(e.data("yqTitle")),r=e.data("yqUrl"),o=t.attr("href"),l=n.data.ga||null,u=n.data.ga_handler||null;if(Yq.yq_panel_click(r,s,a),n.data.ga_override&&"undefined"!=typeof window[n.data.ga_override]){var g=window[n.data.ga_override](e,t,l,u);l=g.obj||l,u=g.handler||u}if(l&&u&&"undefined"!=typeof window[l]){var d={hitType:"event",eventCategory:"Articles",eventAction:"Youneeq View",eventLabel:r};if("sendBeacon"in navigator)d.transport="beacon",window[l](u,d),i&&(window.location=o);else if(i){var c=function(){window.location=o};d.hitCallback=c,window[l](u,d),window.setTimeout(c,1e3)}else window[l](u,d)}else i&&(window.location=o)},YouneeqHandler.register_scroll_handler=function(e,t){if(!e.use_scroll_handler){e.use_scroll_handler=!0;var n=jQuery(e.box);t.on("scroll.yq",function(i){e.scroll_ready&&n.offset().top+n.height()-t.scrollTop()-t.height()<e.scrolling.offset&&(e.scroll_ready=!1,t.trigger("yq:scrollBottom"+e.id_num),window.setTimeout(function(e){e.scroll_ready=!0},e.scrolling.cooldown,e))})}},YouneeqHandler.prototype.refresh=function(e){void 0===e&&(e=[]),this.suggest={},this.init_all_data().request(e)},YouneeqHandler.prototype.request=function(e){if(void 0===e&&(e=[]),!this.is_loading){this.is_loading=!0;var t={},n=!1,i=window.yq_sent_request?Yq.observeMin:Yq.observe;window.yq_sent_request=!0;for(var a=0,s=e.length;a<s;a++)"observe"==e[a]&&(n=!0);this.content_id&&(t.content_id=this.content_id),this.content_type&&(t.content_type=this.content_type),this.alt_href&&(t.alt_href=this.alt_href),Object.keys(this.suggest).length&&(t.suggest=[this.suggest]),n&&Object.keys(this.observe).length&&(t.observe=[this.observe]),i(t,this._populate(e,"ajax_display"in this))}return this},YouneeqHandler.prototype.display=function(e,t){if(e&&e.suggest&&e.suggest.node)for(var n=e.suggest.node,i=jQuery(this.box),a=0,s=n.length;a<s;a++){var r=n[a].id?n[a].id:"",o=n[a].title?n[a].title:"",l=n[a].url?n[a].url:"",u=n[a].image?n[a].image:"",g=n[a].description?n[a].description:"";i.append('<div class="yq-article" data-yq-id="'+r+'" data-yq-title="'+o+'" data-yq-url="'+l+'">\n    <a href="'+l+'">'+(u?'<img class="yq-image" src="'+u+'" alt="'+o+'" />':"")+'\n        <h3 class="yq-title">'+o+"</h3>\n    </a>\n    "+(g?'<p class="yq-desc">'+g+"</p>":"")+"\n</div>")}},YouneeqHandler.prototype.init_all_data=function(e){var t=this.get_args(e);return this.init_request_data(t).init_suggest_data(t).init_observe_data(t).init_tracking(t).init_scrolling(t).init_method_overrides(t).init_features(t).init_handlers(t)},YouneeqHandler.prototype.get_args=function(e){for(var t=e?e:{},n=0,i=this.box.attributes.length;n<i;n++){var a=this.box.attributes[n].name;"data-yq-"==a.substr(0,8)&&(t[a.substr(8).replace(/-/g,"_")]=this.box.attributes[n].value)}return t},YouneeqHandler.prototype.init_request_data=function(e){return"content_id"in e&&(this.content_id=e.content_id),"alt_href"in e?this.alt_href=e.alt_href:this.alt_href=YouneeqHandler.get_og_tag("url"),"content_type"in e&&(this.content_type=e.content_type),this},YouneeqHandler.prototype.init_suggest_data=function(e){if(e.count||e.suggest_count||e.suggest_function){var t=0,n={};"suggest_function"in e&&e.suggest_function in window&&(n=window[e.suggest_function](this)),"name"in n&&(this.content_id=n.name),"count"in n?t=n.count:"count"in e?t=e.count:"suggest_count"in e&&(t=e.suggest_count),t&&(this.suggest={type:"node",count:""+t,is_panel_detailed:"true"},"categories"in n?this.suggest.categories=n.categories:"suggest_categories"in e&&(this.suggest.categories=YouneeqHandler.split(e.suggest_categories)),"domains"in n?n.domains===!0||n.domains===!1?this.suggest.isAllClientDomains="true":this.suggest.domains=n.domains:"suggest_domains"in e?"true"==e.suggest_domains?this.suggest.isAllClientDomains="true":this.suggest.domains=YouneeqHandler.split(e.suggest_domains):this.suggest.isAllClientDomains="false","date_start"in n?this.suggest.date_start=n.date_start:"suggest_date_start"in e&&(this.suggest.date_start=new Date(e.suggest_date_start).toISOString()),"date_end"in n?this.suggest.date_end=n.date_end:"suggest_date_end"in e&&(this.suggest.date_end=new Date(e.suggest_date_end).toISOString()),"panel_custom"in n?this.suggest.panel_custom=n.panel_custom:"suggest_panel_custom"in e&&(this.suggest.panel_custom=YouneeqHandler.split(e.suggest_panel_custom)),"panel_type"in n?this.suggest.panel_type=n.panel_type:"suggest_panel_type"in e&&(this.suggest.panel_type=e.suggest_panel_type),"options"in n?this.suggest.options=n.options:"suggest_options"in e&&(this.suggest.options=YouneeqHandler.split(e.suggest_options)))}return this},YouneeqHandler.prototype.init_observe_data=function(e){if(e.observe||e.observe_function){var t="",n={};if("observe_function"in e&&(n=window[e.observe_function](this)),"name"in n&&(this.content_id=n.name),"observe"in n&&!n.observe)return this;if(t="title"in n?n.title:"observe_title"in e?e.observe_title:YouneeqHandler.get_og_tag("title"),this.content_id&&t){if(this.observe={type:"node",title:t},"url"in n&&(this.alt_href=n.url),"image"in n?this.observe.image=n.image:"observe_image"in e?this.observe.image=e.observe_image:this.observe.image=YouneeqHandler.get_og_tag("image"),"description"in n?this.observe.description=n.description:"observe_description"in e?this.observe.description=e.observe_description:this.observe.description=YouneeqHandler.get_og_tag("description"),"create_date"in n)this.observe.create_date=n.create_date;else if("observe_date"in e)this.observe.create_date=new Date(e.observe_date).toISOString();else{var i=YouneeqHandler.get_meta_tag("article:published_time","date");this.observe.create_date=i instanceof Date?i.toISOString():i}"categories"in n?this.observe.categories=n.categories:"observe_categories"in e&&(this.observe.categories=YouneeqHandler.split(e.observe_categories)),"tags"in n?this.observe.tags=n.tags:"observe_tags"in e&&(this.observe.tags=YouneeqHandler.split(e.observe_tags)),"content_type"in n&&(this.content_type=n.content_type)}}return this},YouneeqHandler.prototype.init_tracking=function(e){return e.ga_function?this.tracking.ga=e.ga_function:this.tracking.ga="ga",e.ga_tracker?this.tracking.ga_tracker=e.ga_tracker:this.tracking.ga_tracker=null,e.ga_override_function?this.tracking.ga_override=e.ga_override_function:this.tracking.ga_override=null,this},YouneeqHandler.prototype.init_scrolling=function(e){if(e.scroll_offset){var t=parseInt(e.scroll_offset);this.scrolling.offset=isNaN(t)?300:t}else this.scrolling.offset=300;if(e.scroll_cooldown){var n=parseInt(e.scroll_cooldown);this.scrolling.cooldown=isNaN(n)?3e3:n}else this.scrolling.cooldown=3e3;return this},YouneeqHandler.prototype.init_method_overrides=function(e){return e.ajax_display_function?this.ajax_display=window[e.ajax_display_function]:e.display_function&&(this.display=window[e.display_function]),this},YouneeqHandler.prototype.init_features=function(e){return e.features&&(this.features=YouneeqHandler.split(e.features)),this},YouneeqHandler.prototype.init_handlers=function(e){for(var t=jQuery(this.box),n=!1,i=0,a=this.features.length;i<a;i++)switch(this.features[i]){case"no-google-analytics":n=!0;break;case"gigya":this.send_gigya_data();break;case"infinite-scroll":this.setup_infinite_scroll();break;case"google-analytics":break;default:window.console.warn("YouneeqHandler: "+this.features[i]+" is not a recognized feature")}return t.one("yq:populateAttach",{disable_ga_tracking:n,tracking_args:this.tracking},this.attach_click_tracking),this},YouneeqHandler.prototype.setup_infinite_scroll=function(){var e=jQuery(window),t=this;return YouneeqHandler.register_scroll_handler(t,e),e.on("yq:scrollBottom"+this.id_num,function(){t.request(["scroll"])}),this},YouneeqHandler.prototype.attach_click_tracking=function(e,t,n){var i=e.data.tracking_args.ga_tracker?e.data.tracking_args.ga_tracker+".send":"send";jQuery(this).on("mousedown.yq",".yq-article a:not(.no-yq-tracking)",{ga:e.data.tracking_args.ga,ga_handler:i,ga_override:e.data.tracking_args.ga_override},function(e){var t=jQuery(this);YouneeqHandler.track_click(t.parents(".yq-article"),t,e)}).on("mousedown.yq","a.yq-article:not(.no-yq-tracking)",{ga:e.data.tracking_args.ga,ga_handler:i,ga_override:e.data.tracking_args.ga_override},function(e){var t=jQuery(this);YouneeqHandler.track_click(t,t,e)})},YouneeqHandler.prototype.send_gigya_data=function(e){var t=this;void 0===e&&(e=1),gigya.isReady?gigya.socialize.getUserInfo({callback:function(e){if(0==e.errorCode){for(var t=e.user,n=["birthDay","birthMonth","birthYear","city","country","email","firstName","gender","lastName","loginProvider","loginProviderUID","nickname","providers","state","zip"],i={idm:{id:t.ID,profile:{UID:t.ID}}},a=0,s=n;a<s.length;a++){var r=s[a];r in t&&(i.idm.profile[r]=t[r])}Yq.observeMin(i,jQuery.noop)}}}):e>0&&window.setTimeout(function(e){t.send_gigya_data(e)},5e3,e-1)},YouneeqHandler.split=function(e){var t=e.match(/\|/g),n=t?t.length:0;return n?e.split("|"):e.split(",")},YouneeqHandler.get_meta_tag=function(e,t,n,i){void 0===n&&(n="property"),void 0===i&&(i="content");var a=jQuery("meta["+n+'="'+e+'"]'),s=null;switch(t){case"date":s=a.length?new Date(a.attr(i)):null;break;default:s=a.length?a.attr(i):""}return s},YouneeqHandler.get_og_tag=function(e){return YouneeqHandler.get_meta_tag("og:"+e)},YouneeqHandler.prototype._populate=function(e,t){var n=this;return void 0===t&&(t=!1),t?function(t){n.is_loading=!1;var i=jQuery(n.box);i.trigger("yq:populatePrepare",[t,e]),n.ajax_display(t,e,function(t){i.trigger("yq:populateAttach",[t,e])})}:function(t){n.is_loading=!1;var i=jQuery(n.box);i.trigger("yq:populatePrepare",[t,e]),n.display(t,e),i.trigger("yq:populateAttach",[t,e])}},YouneeqHandler}();YouneeqHandler.instances=[],jQuery(function(){jQuery("html.yq-no-auto, body.yq-no-auto").length||YouneeqHandler.generate()});
//# sourceMappingURL=../youneeq-lib.min.js.map